# test-runner-cli

### Проблемы

* Моментальное разворачивание инфраструктуры для локальной разработки и тестирования.
* Локальная разработка микросервиса с последующим тестированием взаимодействия с другими сервисами включая UI тестирование.
* Автоматическая проверка регресии (зависимостей на сервис) после изменения кода сервиса.  
* Необходимо локально развернуть часть сервисов и их зависимостей, взаимодействующих между собой.
* Выборочный запуск определенных тестов.  
* Live reload и redeploy сервиса

Как выборочно, локально, запустить определенный набор тестов (unit, интеграционные, компонентные, API, системные)
имея при этом **только исходный код и docker машину** или локально развернутый kubernetes?

При разработке микросервисов, на локальной машине, существует ряд некоторых проблем:
* Как запустить тесты
    * **unit**
    * **интеграционные** тесты, которые требуют зависимостей, например таких как база данных, система кеширования 
    или брокер сообщений. Зависимости необходимо дополнительно разворачивать локально, или указывать внешние сервера, 
    на которых эта зависиимость существует.
    * **компонентные** тесты, которые требуют помимо внешних зависимостей, 
    еще и зависимости от родственных им микросервисов.
    Так как компонентное тестирование подразумевает взаимодействие двух микросервисов между собой. 
    * **API** тесты, с использованием mockserver и без его использования. 
    * **системные** тесты, которые требуют запуска всех зависимостей и всех микросервисов в одной сети. 

#### Требования к архитектуре

* Команда запуска теста не привязана к языку программирования, это может быть
`dotnet test`, `npm run ...`, или другая команда запуска 
* Децентрализация исходного кода 
    * Нет единого репозитория с описанием всех микросервисов
    * В репозитории микросервиса есть **мета-информация** о всех возможных тестах и командах их запуска
* Мета-информация запуска теста содержит информацию о необходимых зависимостях для запуска этих тестов
* Для запуска определенного типа тестов, билдяться и разварачивается ислючительно те контейнеры,
 которые необходимы

Алгоритм запуска примерно такой:
+ При запуске опреденных тестов, построить граф зависимостей. Разные виды тестов зависят от разных сервисов. 
+ Собрать docker image для всех необходимых сервисов и их зависимостей
+ Развернуть необходимый контейнер и все его зависимости в одной сети (например docker-compose, kubernetes)
+ Запустить необходимые тесты внутри развернутого окружения


#### Примеры использования

##### Случай 1. Локальная разработка с последующей прогонкой приемочных тестов по всему продукту, системных, компонентных, api тестов

Микросервисы:
* http://tscore-git.tscrm.com/bpmonline-designer/frontend
* http://tscore-git.tscrm.com/bpmonline-designer/backend
* http://tscore-git.tscrm.com/AcceptanceTests/protractor

Локально выкачан только один [account-service](http://tscore-git.tscrm.com/bpmonline-designer/backend/account-service).
После правок в account-service необходимо убедится что ничего не сломалось.  
Для этого необходимо запустить [приемочные тесты](http://tscore-git.tscrm.com/AcceptanceTests/protractor), 
системные тесты, api тесты в которых должен учавствовать локально изменный код из account-service. 
